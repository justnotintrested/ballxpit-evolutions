<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ball x Pit Evolution Matrix</title>

<style>
  body { 
    font-family: Arial, sans-serif; 
    background:#111; 
    color:#eee; 
    padding:20px; 
  }

  /* --- MATRIX TABLE --- */
  table { 
    border-collapse: collapse; 
    width: 100%; 
    table-layout: fixed;      /* equal column widths */
  }

  th, td {
    border:1px solid #444;
    width: 90px;               /* fixed cell width */
    height: 90px;              /* fixed cell height */
    text-align:center;
    vertical-align: middle;
    overflow: hidden;
  }

  th {
    background:#222;
    font-size: 12px;
  }

  td {
    background:#1a1a1a;
    cursor:pointer;
    font-size: 11px;
  }

  td:hover {
    background:#333;
  }

  td img, th img {
    width: 40px;
    height: 40px;
    object-fit: contain;
    display:block;
    margin: 0 auto 4px auto;
  }

  /* --- POPUP --- */
  .popup-bg {
    position: fixed; 
    top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.7); 
    display:none; 
    justify-content:center; 
    align-items:center;
  }

  .popup {
    background:#222; 
    padding:20px; 
    border-radius:10px; 
    width:350px; 
    text-align:center;
  }

  .popup img { 
    width:80px; 
    margin-bottom:10px;
  }

  .close { 
    margin-top:15px; 
    padding:8px 15px; 
    background:#333; 
    cursor:pointer; 
    border-radius:5px; 
  }
</style>
</head>
<body>

<h1>Ball x Pit Evolution Matrix</h1>
<div id="matrix"></div>

<!-- POPUP WINDOW -->
<div class="popup-bg" id="popbg">
  <div class="popup">
    <h2 id="pTitle"></h2>
    <img id="pImg" src="">
    <p id="pCombo"></p>
    <p id="pEffect"></p>
    <div class="close" onclick="document.getElementById('popbg').style.display='none'">Close</div>
  </div>
</div>

<script>
let baseBalls = [];
let evolutions = [];

/* load base + evolution data */
Promise.all([
  fetch('base.json').then(r=>r.json()),
  fetch('evolutions.json').then(r=>r.json())
]).then(([base, evo]) => {
  baseBalls = base;
  evolutions = evo;
  buildMatrix();
});

/* build matrix table */
function buildMatrix(){
  const names = baseBalls.map(x=>x.name);

  let html = `<table><tr><th></th>`;
  names.forEach(n => 
    html += `<th><img src='img/${toFile(n)}'><div>${n}</div></th>`
  );
  html += `</tr>`;

  names.forEach(row => {
    html += `<tr><th><img src='img/${toFile(row)}'><div>${row}</div></th>`;

    names.forEach(col => {
      const found = evolutions.find(e=> e.row===row && e.col===col);

      if(found){
        html += `
          <td onclick='pop("${found.name}","${found.combo}","${found.effect}","${found.img}")'>
            <img src='img/${found.img}'>
            ${found.name}
          </td>`;
      } else {
        html += `<td></td>`;
      }
    });

    html += `</tr>`;
  });

  html += `</table>`;
  document.getElementById('matrix').innerHTML = html;
}

/* popup info window */
function pop(title, combo, effect, img){
  document.getElementById('pTitle').innerText = title;
  document.getElementById('pCombo').innerText = combo;
  document.getElementById('pEffect').innerText = effect;
  document.getElementById('pImg').src = "img/" + img;
  document.getElementById('popbg').style.display = 'flex';
}

/* convert name â†’ snake_case filename */
function toFile(name){
  return name.toLowerCase().replace(/ /g,'_') + ".png";
}
</script>

</body>
</html>
