<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ball x Pit — Evolution Matrix (retro)</title>
<style>
  /* ---------- Retro / pixel + parchment visual ---------- */
  :root{
    --bg:#0f0d0c;
    --panel:#1b1715;
    --cell:#221e1b;
    --muted:#2b2522;
    --text:#f3e9e0;
    --accent:#d89b3a;
    --brick:#3a2f2a;
    --popup-bg: linear-gradient(180deg,#2b231f,#151210);
  }
  html,body{height:100%;}
  body{
    margin:14px;
    font-family: "Segoe UI", Roboto, system-ui, "Helvetica Neue", Arial;
    background: radial-gradient(circle at 10% 10%, #121212 0%, #090808 60%);
    color:var(--text);
  }

  h1{font-size:18px;margin:0 0 8px 0;letter-spacing:1px}
  .subtitle{color:#bdafa6;font-size:12px;margin-bottom:10px}

  /* container */
  .card {
    background: linear-gradient(180deg,#2a211d,#161211);
    border:6px solid #6b4c33;
    border-radius:8px;
    padding:12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.7), inset 0 2px 0 rgba(255,255,255,0.02);
  }

  /* controls row */
  .topbar { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px; }
  .controls { display:flex; gap:8px; align-items:center; }
  .btn {
    background:#1b1513; color:var(--text); border:1px solid #40322a; padding:6px 10px; border-radius:6px;
    cursor:pointer; font-size:13px;
  }

  /* matrix wrapper */
  .matrix-wrap {
    width:100%;
    height: calc(100vh - 170px);
    overflow:auto;             /* both scrollbars */
    border-radius:6px;
    padding:10px;
    background: linear-gradient(180deg,#0f0d0c,#0b0a0a);
    border:3px solid #2f241a;
  }

  /* table */
  table { border-collapse: collapse; table-layout: fixed; width: max-content; min-width:100%; }
  th, td {
    border:1px solid rgba(255,255,255,0.04);
    width:100px; height:100px;
    box-sizing:border-box;
    padding:6px; text-align:center; vertical-align:middle;
    background: linear-gradient(180deg,var(--cell), #1a1614);
    color:var(--text); font-size:12px;
    display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;
  }
  th { background: linear-gradient(180deg,#241e1b,#1c1714); font-weight:700; color:#e8dfd4; font-size:12px; }
  td.self { background:#0f0f0f; color:#ddd; cursor:default; }
  td.evo-missing { opacity:0.25; } 
  td.evo-found { outline:2px solid rgba(216,155,58,0.12); box-shadow: inset 0 0 0 1px rgba(216,155,58,0.03); cursor:pointer; }

  th img, td img { width:44px; height:44px; object-fit:contain; image-rendering: pixelated; }

  /* popup (parchment) */
  .popup-bg {
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background: rgba(0,0,0,0.6); z-index:9999;
  }
  .popup {
    width:420px; max-width:92%; border-radius:10px; padding:18px;
    background: linear-gradient(180deg,#f6ecd9,#e8dcc2);
    color:#2b251e; box-shadow:0 20px 80px rgba(0,0,0,0.7);
    border:6px solid #463422; font-family: "Trebuchet MS", Arial, sans-serif;
    text-align:center;
  }
  .popup .title { font-size:20px; font-weight:800; margin-bottom:6px; letter-spacing:1px; color:#1b120e; }
  .popup .combo { color:#3b2a23; font-weight:700; margin-bottom:8px; }
  .popup img { width:120px; height:120px; object-fit:contain; image-rendering: pixelated; border:4px solid rgba(0,0,0,0.06); background:#000; display:block; margin:0 auto 12px; }
  .popup .effect { text-align:left; font-size:13px; line-height:1.3; color:#2a2320; max-height:220px; overflow:auto; padding:6px 8px; background: rgba(255,255,255,0.6); border-radius:6px; border:1px solid rgba(0,0,0,0.05); }
  .popup .close { margin-top:12px; display:inline-block; padding:8px 12px; background:#3b2a23; color:#f7eedf; border-radius:6px; cursor:pointer; }

  /* footer hint */
  .hint { margin-top:10px; color:#bfb1a2; font-size:12px; }
</style>
</head>
<body>

<div class="card">
  <div class="topbar">
    <div>
      <h1>Ball x Pit — Evolution Matrix</h1>
      <div class="subtitle">Click a cell to view the evolution (retro UI)</div>
    </div>
    <div class="controls">
      <button class="btn" id="downloadBtn">Download evolutions.json</button>
      <button class="btn" id="refreshBtn">Refresh data</button>
    </div>
  </div>

  <div class="matrix-wrap" id="matrixWrap">
    <div id="matrix"></div>
  </div>

  <div class="hint">Put icon files in <strong>img/</strong> using snake_case (e.g. <span style="font-family:monospace">brood_mother.png</span>). Missing images show a placeholder.</div>
</div>

<!-- popup -->
<div class="popup-bg" id="popupBg" aria-hidden="true">
  <div class="popup" role="dialog" aria-modal="true">
    <div class="title" id="popName">BOMB</div>
    <img id="popImg" src="">
    <div class="combo" id="popCombo">BURN × IRON</div>
    <div class="effect" id="popEffect">Explodes when hitting an enemy...</div>
    <div><button class="close" id="popClose">Close</button></div>
  </div>
</div>

<script>
/* ----------------- DATA (embedded sample) ----------------- 
   Replace these arrays or modify them. Images are expected
   in img/ (snake_case). This page is standalone (no editor).
----------------------------------------------------------*/
const baseData = [
  "BLEED","BROOD MOTHER","BURN","CELL","CHARM","DARK","EARTHQUAKE",
  "EGG SAC","FREEZE","GHOST","IRON","LAZER H","LAZER V","LIGHT",
  "LIGHTNING","POISON","VAMPIRE","WIND"
];

/* sample evolutions expanded. row=left base, col=right base */
const evolutionsData = [
  {row:"BURN", col:"IRON", name:"Bomb", combo:"Burn × Iron", effect:"Explodes when hitting an enemy, dealing 150-300 damage to nearby enemies. 3s cooldown.", img:"ballxpitbomb.jfif"},
  {row:"BLEED", col:"IRON", name:"Hemorrhage", combo:"Bleed × Iron", effect:"Inflicts stacks of bleed; consumes stacks at threshold for big damage.", img:"ballxpithe m.jfif"},
  {row:"FREEZE", col:"LIGHTNING", name:"Blizzard", combo:"Freeze × Lightning", effect:"Freezes nearby enemies briefly and deals damage.", img:"ballxpitblizzard.jfif"},
  {row:"CHARM", col:"BURN", name:"Berserk", combo:"Charm × Burn", effect:"Chance to make enemies berserk, dealing area damage.", img:"ballxpitberserk.jfif"},
  {row:"LAZER H", col:"POISON", name:"Radiation Beam", combo:"Laser(H) × Poison", effect:"Radiation beam deals damage and applies radiation stacks.", img:"ballxpitradbeam.jfif"},
  {row:"VAMPIRE", col:"BROOD MOTHER", name:"Mosquito King", combo:"Vampire × Brood Mother", effect:"Spawns mosquitos that steal health when they kill enemies.", img:"ballxpitmosquitoking.jfif"},
  {row:"BLEED", col:"DARK", name:"Sacrifice", combo:"Bleed × Dark", effect:"Inflicts bleed and curse; cursed enemies take damage after hits.", img:"ballxpitsacri.jfif"},
  {row:"BURN", col:"FREEZE", name:"Frozen Flame", combo:"Burn × Freeze", effect:"Applies frostburn; stacks cause damage over time.", img:"ballxpitfrozenflame.jfif"},
  {row:"BURN", col:"EARTHQUAKE", name:"Phantom", combo:"Burn × Earthquake", effect:"Curses enemies; cursed enemies take big damage after hits.", img:"ballxpitphantom.jfif"}
  // (add more entries; this is sample)
];

/* ----------------- core rendering logic ----------------- */
const matrixEl = document.getElementById('matrix');
const popupBg = document.getElementById('popupBg');
const popName = document.getElementById('popName');
const popImg = document.getElementById('popImg');
const popCombo = document.getElementById('popCombo');
const popEffect = document.getElementById('popEffect');
const popClose = document.getElementById('popClose');

function buildMatrix(baseList, evolutions){
  const names = baseList.slice(); // copy
  let html = '<table><tr><th></th>';
  // header columns
  for(const n of names){
    html += `<th><img src="img/${toFile(n)}" onerror="this.style.opacity=.25"><div style="font-weight:700;margin-top:6px">${short(n)}</div></th>`;
  }
  html += '</tr>';

  // rows
  for(const row of names){
    html += `<tr><th><img src="img/${toFile(row)}" onerror="this.style.opacity=.25"><div style="font-weight:700;margin-top:6px">${short(row)}</div></th>`;
    for(const col of names){
      if(row===col){
        html += `<td class="self">—</td>`;
        continue;
      }
      const found = evolutions.find(e=> e.row===row && e.col===col);
      if(found){
        html += `<td class="evo-found" data-row="${escape(row)}" data-col="${escape(col)}"
                    data-name="${escape(found.name)}" data-combo="${escape(found.combo||'')}"
                    data-effect="${escape(found.effect||'')}" data-img="${escape(found.img||'')}">
                    <img src="img/${found.img}" onerror="this.style.opacity=.25">
                    <div style="font-size:12px">${short(found.name)}</div>
                 </td>`;
      } else {
        html += `<td class="evo-missing" data-row="${escape(row)}" data-col="${escape(col)}"></td>`;
      }
    }
    html += `</tr>`;
  }

  html += '</table>';
  matrixEl.innerHTML = '';
  matrixEl.insertAdjacentHTML('beforeend', html);

  // attach click handlers
  matrixEl.querySelectorAll('td.evo-found').forEach(td=>{
    td.addEventListener('click', ()=>openPopup(td));
  });
  // optional: click empty cells do nothing
}

function openPopup(td){
  const name = td.dataset.name || "";
  const combo = td.dataset.combo || "";
  const effect = td.dataset.effect || "";
  const img = td.dataset.img || "";

  popName.textContent = name || "Unknown";
  popCombo.textContent = combo || "";
  popEffect.textContent = effect || "";
  if(img){
    popImg.src = "img/" + img;
    popImg.onerror = ()=>popImg.style.opacity = 0.3;
  } else {
    popImg.src = "img/placeholder.png";
  }
  popupBg.style.display = "flex";
  popupBg.setAttribute('aria-hidden','false');
}

popClose.addEventListener('click', ()=>{ popupBg.style.display='none'; popupBg.setAttribute('aria-hidden','true'); });

/* small utilities */
function toFile(n){ return n.toLowerCase().replace(/ /g,'_') + '.png'; }
function short(s){ return s.length>12? s.slice(0,11)+'…': s; }
function escape(s){ return String(s).replace(/"/g,'&quot;'); }

/* download JSON button (exports current embedded JSON) */
document.getElementById('downloadBtn').onclick = ()=>{
  const blob = new Blob([JSON.stringify(evolutionsData,null,2)],{type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='evolutions.json'; a.click();
};

/* refresh button (rebuilds matrix) */
document.getElementById('refreshBtn').onclick = ()=> buildMatrix(baseData, evolutionsData);

/* initial render */
buildMatrix(baseData, evolutionsData);
</script>
</body>
</html>
